name: Pull request

on:
  pull_request:
env:
  HUGGING_FACE_TOKEN: ${{ secrets.HUGGING_FACE_TOKEN }}
jobs:
  test_mac:
    runs-on: macos-latest
    steps:
    - name: checkout repo
      uses: actions/checkout@v4
    - name: Install uv
      uses: astral-sh/setup-uv@v5
    - run: uv venv -p 3.11 --system
    - run: uv pip install policyengine-uk==2.15
    - run: uv run python test.py
  test_ubuntu:
    runs-on: ubuntu-latest
    steps:
    - name: checkout repo
      uses: actions/checkout@v4
    - name: Install uv
      uses: astral-sh/setup-uv@v5
    - run: uv venv -p 3.11 --system
    - run: uv pip install policyengine-uk==2.15
    - run: uv run python test.py
  build:
    name: Build
    # Any runner supporting Node 20 or newer
    runs-on: ubuntu-latest
    environment: beta

    # Add "id-token" with the intended permissions.
    permissions:
      contents: "read"

    steps:
    - name: checkout repo
      uses: actions/checkout@v4
    - name: Install uv
      uses: astral-sh/setup-uv@v5
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: "3.11"
    - name: Set up poetry
      run: uv pip install poetry --system
    #required to support python/typescript/etc. service client generation
    - name: Set up JDK 11 for x64
      uses: actions/setup-java@v4
      with:
        java-version: '11'
        distribution: 'temurin'
        architecture: x64
    - name: Build application
      run: make build
