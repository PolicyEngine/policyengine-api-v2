TAG?=desktop
REPO?=api-v2
REGION?=us-central1
ifdef LOG_DIR
  BUILD_ARGS=--gcs-log-dir ${LOG_DIR}
endif

# Loads the PROJECT_ID as generated by running a project
# bootstrap.
include ../../terraform/.bootstrap_settings/project.env

deploy:
	rm -rf build/staging
	mkdir -p build/staging/libs
	cp -R ../../libs/* build/staging/libs/
	gcloud builds submit --region=${REGION} --tag ${REGION}-docker.pkg.dev/${PROJECT_ID}/${REPO}/policyengine-simulation-api:${TAG} ${BUILD_ARGS}

build:
	poetry install
	@echo "TODO: add back in the tests"
